<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lead Levels by Borough – {{ year }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #1e2a38;
      color: white;
      padding: 2rem;
      font-family: sans-serif;
    }
    svg g:hover {
      stroke: white;
      stroke-width: 2;
      cursor: pointer;
    }
    .legend-box {
      margin: 2rem auto;
      display: flex;
      justify-content: center;
      gap: 4px;
      flex-wrap: wrap;
    }
    footer {
      text-align: center;
      margin-top: 2rem;
    }
    .map-container {
      max-width: 100%;
      overflow-x: auto;
    }
    svg {
      width: 100%;
      height: auto;
    }
  </style>
</head>
<body>

  {% include 'navbar.html' %}

  <h1 style="text-align: center;">Blood Lead Levels in {{ year }}</h1>

  <!-- Responsive map container -->
  <div class="map-container">
    {% include 'NYC_boroughs.svg' %}
  </div>

  <!-- Inline style fill per borough using precomputed lightness -->
  <script>
    const boroughFills = {
      "The_Bronx": "hsl(0, 100%, {{ borough_lightness['Bronx'] }}%)",
      "Brooklyn": "hsl(0, 100%, {{ borough_lightness['Brooklyn'] }}%)",
      "Manhattan": "hsl(0, 100%, {{ borough_lightness['Manhattan'] }}%)",
      "Queens": "hsl(0, 100%, {{ borough_lightness['Queens'] }}%)",
      "Staten_Island": "hsl(0, 100%, {{ borough_lightness['Staten Island'] }}%)"
    };

    for (const id in boroughFills) {
      const el = document.getElementById(id);
      if (el) {
        el.style.fill = boroughFills[id];
      }
    }
  </script>

  <!-- Legend -->
  <svg width="420" height="120" class="legend-box">
    {% for i in range(10) %}
      <rect x="{{ i*40 + 10 }}" y="10" width="40" height="80" fill="hsl(0, 100%, {{ 85 - i*5 }})" />
      <text x="{{ i*40 + 30 }}" y="105" text-anchor="middle" font-size="11" fill="white">
        {{ legend_values[i] }}
      </text>
    {% endfor %}
    <text x="210" y="115" text-anchor="middle" font-size="13" fill="white"># of Children w/ BLL ≥ 5 µg/dL</text>
  </svg>

  <footer>
    <p>Data from NYC Open Data</p>
  </footer>
</body>
</html>